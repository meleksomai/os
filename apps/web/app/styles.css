@import "@workspace/ui/globals.css";

code[data-theme*=" "],
code[data-theme*=" "] span {
  color: var(--shiki-light);
}

code[data-line-numbers] {
  counter-reset: line;
}

html.dark code[data-theme*=" "],
html.dark code[data-theme*=" "] span {
  color: var(--shiki-dark);
}

pre {
  overflow-x: auto !important;
}

pre [data-line] {
  padding-left: 1rem;
  padding-right: 1rem;
}

code[data-line-numbers] {
  counter-reset: line;
}

code[data-line-numbers] > [data-line]::before {
  counter-increment: line;
  content: counter(line);
  display: inline-block;
  width: 0.75rem;
  margin-right: 1rem;
  text-align: right;
  color: gray;
}

code[data-line-numbers-max-digits="2"] > [data-line]::before {
  width: 1.25rem;
}

code[data-line-numbers-max-digits="3"] > [data-line]::before {
  width: 1.75rem;
}

code[data-line-numbers-max-digits="4"] > [data-line]::before {
  width: 2.25rem;
}

/* Highlight background inside code blocks */
pre code mark {
  background: var(--code-highlight);
  color: inherit; /* critical: keep syntax token color */
  border: 1px solid var(--code-highlight-border);
  border-radius: 0.375rem; /* subtle pill */
  padding: 0.05rem 0.25rem; /* tighter than default */
  box-decoration-break: clone; /* if mark wraps across lines */
}

pre code mark * {
  background: transparent !important;
  box-shadow: none !important;
}

/* Base: each line should be positioning context */
pre [data-line] {
  position: relative;
}

/* Highlighted line: attribute pattern (rehype-pretty-code common) */
pre [data-line][data-highlighted-line],
pre [data-line][data-highlighted] {
  background: var(--code-line-highlight, transparent);
}

/* Highlighted line: class-based pattern (some setups) */
pre [data-line].highlighted,
pre [data-line].line--highlighted {
  background: var(--code-line-highlight, transparent);
}

/* If your renderer wraps the whole line with <mark>, make mark span full width */
pre [data-line] > mark {
  display: block;
  background: var(--code-line-highlight, transparent);
  color: inherit;
  padding: 0; /* keep line padding controlled by [data-line] */
  border-radius: 0; /* line highlight shouldn’t look like a pill */
}

/* Make sure token-level backgrounds don’t fight with line background */
pre [data-line][data-highlighted-line] * {
  background: transparent !important;
}

/* Rehype Pretty Code / Shiki commonly use data-highlighted-line or data-highlighted */
pre [data-line][data-highlighted-line],
pre [data-line][data-highlighted] {
  background: var(--code-line-highlight);
  box-shadow: inset 2px 0 0 var(--code-line-accent);
}

/* Other common class-based patterns */
pre [data-line].highlighted,
pre [data-line].line--highlighted {
  background: var(--code-line-highlight);
  box-shadow: inset 2px 0 0 var(--code-line-accent);
}
